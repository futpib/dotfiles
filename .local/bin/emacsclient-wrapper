#!/usr/bin/env bash

filename_argument="$1"
line_column_argument=""

if [[ "$filename_argument" =~ ^[^:]+:[0-9]+:[0-9]+$ ]]; then
    line_column_argument="$(echo "$filename_argument" | cut -d : -f 2-3)"
    filename_argument="$(echo "$filename_argument" | cut -d : -f 1)"
elif [[ "$filename_argument" =~ ^[^:]+:[0-9]+:in$ ]]; then
    line_column_argument="$(echo "$filename_argument" | cut -d : -f 2)"
    filename_argument="$(echo "$filename_argument" | cut -d : -f 1)"
fi

if ! [ -f "$filename_argument" ]; then
    readarray -t found_filenames < <(find . -path '*'"$filename_argument")
    if [ "${#found_filenames[@]}" -eq 0 ]; then
        echo No such file
        exit 1;
    elif [ "${#found_filenames[@]}" -eq 1 ]; then
        filename_argument="$found_filenames"
    else
        echo Multiple files found:
        echo "${found_filenames[*]}" | xargs -n 1 echo
        exit 1;
    fi
fi

if [[ -z "$line_column_arguments" ]]; then
    emacsclient -n "$filename_argument"
else
    emacsclient -c "$line_column_argument" -n "$filename_argument"
fi
